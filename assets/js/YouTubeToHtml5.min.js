"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function YouTubeToHtml5(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};for(var o in this.hooks={},this.options={},this.defaultOptions)this.options[o]=o in t?t[o]:this.defaultOptions[o];this.options.autoload&&this.load()}YouTubeToHtml5.prototype.defaultOptions={selector:"video[data-yt2html5]",attribute:"data-yt2html5",formats:"*",autoload:!0,withAudio:!1},YouTubeToHtml5.prototype.globalHooks={},YouTubeToHtml5.prototype.getHooks=function(t,o){var e=[];if(t in this.globalHooks){var n=this.globalHooks[t];n=(n=n.filter(function(t){return t.name===o})).sort(function(t,o){return t.priority-o.priority}),e=e.concat(n)}if(t in this.hooks){var r=this.hooks[t];r=(r=r.filter(function(t){return t.name===o})).sort(function(t,o){return t.priority-o.priority}),e=e.concat(r)}return e},YouTubeToHtml5.prototype.doAction=function(t){for(var o=this.getHooks("actions",t),e=arguments.length,n=Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];for(var i=0;i<o.length;i++){var p;(p=o[i]).callback.apply(p,n)}},YouTubeToHtml5.prototype.applyFilters=function(t,o,...e){const n=this.getHooks("filters",t);for(let t=0;t<n.length;t++)o=n[t].callback(o,...e);return o},YouTubeToHtml5.prototype.itagMap={5:"240x400",6:"???",13:"???",17:"144x176",18:"360p",22:"720p",34:"360x640",35:"480x854",36:"240x320",37:"1080p",38:"3072p",43:"360x640",44:"480x854",45:"720x1280",46:"1080x1920",82:"360p3d",83:"480p3d",84:"720p3d",85:"1080p3d",92:"240p",93:"360p",94:"480p",95:"720p",96:"1080p",100:"360p",101:"480p",102:"720p",151:"72p",132:"240p",133:"240pna",134:"360pna",135:"480pna",136:"720pna",137:"1080pna",138:">1080p",139:"48kbps",140:"128kbps",141:"256kbps",160:"144pna",171:"128k",172:"256k",242:"240p",243:"360p",244:"480p",245:"480p",246:"480p",247:"720p",248:"1080p",264:"1440pna",298:"720p60",299:"1080p60na"},YouTubeToHtml5.prototype.urlToId=function(t){const o=t.match(/^(?:http(?:s)?:\/\/)?(?:www\.)?(?:m\.)?(?:youtu\.be\/|(?:(?:youtube-nocookie\.com\/|youtube\.com\/)(?:(?:watch)?\?(?:.*&)?v(?:i)?=|(?:embed|v|vi|user)\/)))([a-zA-Z0-9\-_]*)/);return Array.isArray(o)&&o[1]?o[1]:t},YouTubeToHtml5.prototype.getAllowedFormats=function(){let t=[];return Array.isArray(this.options.formats)?t=this.options.formats:this.itagMap[this.options.formats]?t=[this.options.formats]:"*"===this.options.formats&&(t=Object.values(this.itagMap).reverse()),t},YouTubeToHtml5.prototype.getElements=function(t){var o=null;return t&&(o=NodeList.prototype.isPrototypeOf(t)||HTMLCollection.prototype.isPrototypeOf(t)?t:"object"==typeof t&&"nodeType"in t&&t.nodeType?[t]:document.querySelectorAll(this.options.selector)),o=Array.from(o||""),this.applyFilters("elements",o)},YouTubeToHtml5.prototype.parseUriString=function(t){return t.split("&").reduce(function(t,o){const e=o.split("=").map(function(t){return decodeURIComponent(t.replace("+"," "))});return t[e[0]]=e[1],t},{})},YouTubeToHtml5.prototype.canPlayType=function(t){var o=null;const e=(o=/^audio/i.test(t)?document.createElement("audio"):document.createElement("video"))&&"function"==typeof o.canPlayType?o.canPlayType(t):"unknown";return e||"no"},YouTubeToHtml5.prototype.load=function(){const t=this.getElements(this.options.selector);t&&t.length&&t.forEach(t=>{this.loadSingle(t)})},YouTubeToHtml5.prototype.loadSingle=function(t,o=null){var e=this;const n=o||this.options.attribute;if(t.getAttribute(n)){const o=this.urlToId(t.getAttribute(n));this.doAction("api.before",t);let i=[];var r=new XMLHttpRequest;r.open("GET","/yt_info.php?url=https://youtu.be/"+o,!0),r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){for(var n in a=JSON.parse(r.responseText).links){var p=a[n];if(p&&"itag"in p&&e.itagMap[p.itag]){let t={_raw:p,itag:p.itag,url:null,label:null,type:"unknown",mime:"unknown",hasAudio:!1,browserSupport:"unknown"};"url"in p&&p.url&&(t.url=p.url);var u=p.format.split(", ");("audioQuality"in p&&p.audioQuality||-1!==u.indexOf("audio"))&&(t.hasAudio=!0),"qualityLabel"in p&&p.qualityLabel?t.label=p.qualityLabel:t.label=e.itagMap[p.itag],null!=u&&(-1!==u.indexOf("video")?t.type="video":-1!==u.indexOf("audio")&&(t.type="audio"),t.mime=u[0],t.browserSupport=e.canPlayType(`${t.type}/${t.mime}`)),t.url&&i.push(t)}}var a=i;if(a&&Array.isArray(a)){(a=a.filter(function(o){return o.type===t.tagName.toLowerCase()})).sort(function(t,o){const e={unknown:-1,no:-1,maybe:0,probably:1};return e[t.browserSupport]+e[o.browserSupport]}),e.options.withAudio&&(a=a.filter(function(t){return t.hasAudio}));const n=e.getAllowedFormats();var l=null,s=null;for(let t=0;t<n.length;t++){const o=n[t],r=a.filter(t=>e.itagMap[t.itag]===o);if(r&&r.length){l=r.shift(),s=o;break}}let r={src:"",type:""};(l=e.applyFilters("video.stream",l,t,s,a))&&"url"in l&&l.url&&(r.src=l.url),l.type&&"unknown"!==l.type&&l.mime&&"unknown"!==l.mime&&(r.type=`${l.type}/${l.mime}`),r.src=e.applyFilters("video.source",r.src,l,t,s,a),r.src&&"function"==typeof r.src.toString&&r.src.toString().length?(t.src=r.src,r.type&&r.type.length&&(t.type=r.type)):console.warn(`YouTubeToHtml5 unable to load video for ID: ${o}`)}}},r.send()}},"object"===("undefined"==typeof module?"undefined":_typeof(module))&&"object"===_typeof(module.exports)&&(module.exports=YouTubeToHtml5);